<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SevMenu 열기</title>
  <meta name="description" content="SevMenu 앱에서 바로 열기" />

  <!-- iOS Smart App Banner (iOS Safari에서 상단 배너로 '열기/보기' 제공)
       app-id는 App Store Connect의 앱 ID (숫자)로 교체 -->
  <meta name="apple-itunes-app" content="app-id=6499293178, app-argument=sevmenu://open" />

  <!-- 공유용(Open Graph) -->
  <meta property="og:title" content="SevMenu 열기" />
  <meta property="og:description" content="앱에서 바로 열어보세요." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="" />

  <style>
    :root { color-scheme: light dark; }
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", sans-serif; margin: 0; }
    .wrap { max-width: 720px; margin: 0 auto; padding: 24px; }
    .card { border: 1px solid rgba(0,0,0,.12); border-radius: 16px; padding: 20px; }
    h1 { margin: 0 0 8px; font-size: 22px; }
    p  { margin: 0 0 14px; opacity: .85; line-height: 1.5; }
    .row { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 14px; }
    button, a.btn {
      appearance: none; border: 0; border-radius: 12px; padding: 12px 14px;
      font-weight: 700; cursor: pointer; text-decoration: none; display: inline-flex; align-items: center;
    }
    .primary { background: #111; color: #fff; }
    .secondary { background: rgba(0,0,0,.08); color: #111; }
    .small { font-size: 13px; opacity: .8; margin-top: 10px; }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace; font-size: 12px; opacity: .75; word-break: break-all; }
    @media (prefers-color-scheme: dark) {
      .card { border-color: rgba(255,255,255,.16); }
      .primary { background: #fff; color: #000; }
      .secondary { background: rgba(255,255,255,.12); color: #fff; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <h1>SevMenu 열기</h1>
      <p id="subtitle">앱이 설치되어 있으면 자동으로 열립니다. 설치되어 있지 않다면 스토어로 안내합니다.</p>

      <div class="row">
        <button id="openBtn" class="primary">앱에서 열기</button>
        <a id="storeBtn" class="btn secondary" href="#" rel="noopener">스토어로 이동</a>
      </div>

      <p class="small" id="hint"></p>
      <div class="mono" id="debug"></div>
    </div>
  </div>

  <script>
  const ANDROID_PACKAGE = "com.sev.menu";
  const PLAY_STORE_URL  = "https://play.google.com/store/apps/details?id=" + encodeURIComponent(ANDROID_PACKAGE);

  const APP_STORE_URL   = "https://apps.apple.com/app/id6499293178";

  // iOS용(커스텀 스킴)
  const CUSTOM_SCHEME_PREFIX = "sevmenu://open";

  // App Links로 사용할 host (너는 github pages)
  const BASE_HOST = "https://dorivan2001.github.io";

  // 현재 랜딩 URL의 path/query/hash
  const currentPath = location.pathname;               // e.g. "/" or "/something"
  const currentTail = location.search + location.hash; // "?x=1#y"

  const ua = navigator.userAgent || "";
  const isAndroid = /Android/i.test(ua);
  const isIOS = /iPhone|iPad|iPod/i.test(ua);

  const storeBtn = document.getElementById("storeBtn");
  storeBtn.href = isAndroid ? PLAY_STORE_URL : (isIOS ? APP_STORE_URL : PLAY_STORE_URL);

  const subtitle = document.getElementById("subtitle");
  if (isAndroid) subtitle.textContent = "안드로이드: 앱이 설치되어 있으면 열리고, 아니면 Play 스토어로 안내합니다.";
  else if (isIOS) subtitle.textContent = "아이폰: 앱이 설치되어 있으면 열립니다. 미설치 시 App Store에서 설치해 주세요. (상단 배너가 보일 수 있어요)";
  else subtitle.textContent = "모바일에서 열면 앱으로 연결됩니다.";

  function buildAppLinkUrl() {
    // 랜딩이 "/"일 때는 기본적으로 앱 홈으로 보내고,
    // 이미 누군가가 특정 경로로 들어온 경우(예: /menu/123)라면 그 경로를 /app 밑으로 매핑
    // 예:
    //   /              -> /app/
    //   /menu/123      -> /app/menu/123
    //   /whatever?x=1  -> /app/whatever?x=1
    const path = (currentPath === "/" ? "/app/" : ("/app" + currentPath));
    return BASE_HOST + path + currentTail;
  }

  function tryOpenApp() {
    const debug = document.getElementById("debug");
    const hint = document.getElementById("hint");

    if (isAndroid) {
      // ✅ 가장 안정적: App Link URL로 이동 (설치되면 OS가 앱으로 전환)
      const appLinkUrl = buildAppLinkUrl();
      debug.textContent = "Android → open via App Link: " + appLinkUrl;
      hint.textContent = "앱 열기를 시도 중입니다…";
      location.href = appLinkUrl;
      return;
    }

    if (isIOS) {
      // iOS는 Universal Links를 따로 구성한 경우엔 appLinkUrl을 써도 되고,
      // 지금은 Smart App Banner + 커스텀 스킴 조합이므로 스킴으로 시도
      const schemeUrl = CUSTOM_SCHEME_PREFIX + (currentPath === "/" ? "" : currentPath) + currentTail;
      debug.textContent = "iOS → open via scheme: " + schemeUrl;
      hint.textContent = "앱 열기를 시도 중입니다…";
      location.href = schemeUrl;

      setTimeout(() => {
        hint.textContent = "앱이 열리지 않으면 아래 '스토어로 이동'을 눌러 설치해 주세요.";
      }, 800);
      return;
    }

    hint.textContent = "모바일(안드로이드/아이폰)에서 열면 앱으로 연결됩니다.";
    debug.textContent = "Current URL: " + location.href;
  }

  document.getElementById("openBtn").addEventListener("click", tryOpenApp);

  // OG url 채우기
  const og = document.querySelector('meta[property="og:url"]');
  if (og) og.setAttribute("content", location.href);
</script>
</body>
</html>
